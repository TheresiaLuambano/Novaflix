<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Company Applications - Admin - BurudaniKiganjani</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <style>
        body {
            background-color: #141414;
            color: #fff;
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            margin: 0;
        }
        
        .admin-container {
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 250px;
            background-color: #1f1f1f;
            padding: 20px;
            position: fixed;
            height: 100vh;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #e50914;
            margin-bottom: 30px;
            display: block;
        }
        
        .nav-item {
            display: block;
            padding: 12px 15px;
            color: #b3b3b3;
            text-decoration: none;
            border-radius: 4px;
            margin-bottom: 5px;
        }
        
        .nav-item:hover, .nav-item.active {
            background-color: #333;
            color: #fff;
        }
        
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 30px;
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .page-title {
            font-size: 28px;
            font-weight: 600;
        }
        
        .stats-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background-color: #1f1f1f;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #e50914;
        }
        
        .stat-label {
            color: #b3b3b3;
            font-size: 14px;
        }
        
        .card {
            background-color: #1f1f1f;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .filters {
            display: flex;
            gap: 10px;
        }
        
        .filter-btn {
            padding: 8px 16px;
            background-color: transparent;
            border: 1px solid #333;
            color: #b3b3b3;
            border-radius: 20px;
            cursor: pointer;
        }
        
        .filter-btn.active {
            background-color: #fff;
            color: #000;
            border-color: #fff;
        }
        
        .application-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #333;
        }
        
        .application-item:last-child {
            border-bottom: none;
        }
        
        .application-info h3 {
            margin: 0 0 5px;
            font-size: 16px;
        }
        
        .application-info p {
            margin: 0;
            color: #b3b3b3;
            font-size: 13px;
        }
        
        .application-meta {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .badge-pending {
            background-color: rgba(255, 160, 10, 0.2);
            color: #ffa00a;
        }
        
        .badge-approved {
            background-color: rgba(70, 211, 105, 0.2);
            color: #46d369;
        }
        
        .badge-rejected {
            background-color: rgba(229, 9, 20, 0.2);
            color: #e50914;
        }
        
        .btn {
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            border: none;
        }
        
        .btn-primary {
            background-color: #e50914;
            color: #fff;
        }
        
        .btn-success {
            background-color: #46d369;
            color: #000;
        }
        
        .btn-danger {
            background-color: #e50914;
            color: #fff;
        }
        
        .btn-secondary {
            background-color: transparent;
            border: 1px solid #333;
            color: #fff;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #b3b3b3;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #b3b3b3;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal {
            background-color: #1f1f1f;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            padding: 30px;
        }
        
        .modal-title {
            font-size: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #b3b3b3;
        }
        
        .form-textarea {
            width: 100%;
            padding: 12px;
            background-color: #141414;
            border: 1px solid #333;
            border-radius: 4px;
            color: #fff;
            min-height: 100px;
            resize: vertical;
        }
        
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <aside class="sidebar">
            <a href="index.html" class="logo">ðŸ“º BurudaniKiganjani</a>
            <a href="index.html" class="nav-item">Dashboard</a>
            <a href="users.html" class="nav-item">Users</a>
            <a href="content.html" class="nav-item">Content</a>
            <a href="companies.html" class="nav-item active">Companies</a>
            <a href="analytics.html" class="nav-item">Analytics</a>
            <a href="../index.html" class="nav-item" style="margin-top: 30px;">View Site</a>
        </aside>
        
        <main class="main-content">
            <div class="page-header">
                <h1 class="page-title">Company Applications</h1>
            </div>
            
            <div class="stats-row">
                <div class="stat-card">
                    <div class="stat-value" id="stat-pending">0</div>
                    <div class="stat-label">Pending Review</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-approved">0</div>
                    <div class="stat-label">Approved</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-rejected">0</div>
                    <div class="stat-label">Rejected</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-total">0</div>
                    <div class="stat-label">Total Companies</div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Applications</h2>
                    <div class="filters">
                        <button class="filter-btn active" onclick="filterApplications('pending')">Pending</button>
                        <button class="filter-btn" onclick="filterApplications('approved')">Approved</button>
                        <button class="filter-btn" onclick="filterApplications('rejected')">Rejected</button>
                        <button class="filter-btn" onclick="filterApplications('all')">All</button>
                    </div>
                </div>
                
                <div id="applications-list">
                    <div class="loading">Loading applications...</div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Review Modal -->
    <div class="modal-overlay" id="review-modal">
        <div class="modal">
            <h3 class="modal-title">Review Application</h3>
            <input type="hidden" id="review-company-id">
            <input type="hidden" id="review-action">
            
            <div class="form-group">
                <label class="form-label">Notes (optional)</label>
                <textarea class="form-textarea" id="review-notes" placeholder="Add any notes about this decision..."></textarea>
            </div>
            
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn btn-danger" id="reject-btn" onclick="submitReview('reject')">Reject</button>
                <button class="btn btn-success" id="approve-btn" onclick="submitReview('approve')">Approve</button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '../../api';
        let authToken = localStorage.getItem('auth_token');
        let currentFilter = 'pending';
        let applications = [];

        document.addEventListener('DOMContentLoaded', function() {
            loadApplications();
        });

        async function loadApplications() {
            try {
                const response = await fetch(`${API_BASE}/company/admin/list.php?status=${currentFilter}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    applications = data.data.applications;
                    renderApplications();
                    updateStats(data.data.stats);
                }
            } catch (error) {
                console.error('Failed to load applications:', error);
                document.getElementById('applications-list').innerHTML = 
                    '<div class="empty-state">Failed to load applications</div>';
            }
        }

        function renderApplications() {
            const container = document.getElementById('applications-list');
            
            if (applications.length === 0) {
                container.innerHTML = '<div class="empty-state">No applications found</div>';
                return;
            }
            
            container.innerHTML = applications.map(app => `
                <div class="application-item">
                    <div class="application-info">
                        <h3>${escapeHtml(app.company_name || app.name)}</h3>
                        <p>${escapeHtml(app.email)} â€¢ ${escapeHtml(app.business_type || 'Content Provider')}</p>
                        <p>Submitted: ${new Date(app.submitted_at || app.created_at).toLocaleDateString()}</p>
                    </div>
                    <div class="application-meta">
                        <span class="badge badge-${app.status}">${app.status}</span>
                        <div class="action-buttons">
                            ${app.status === 'pending' ? `
                                <button class="btn btn-success" onclick="openReviewModal(${app.company_id || app.id}, 'approve')">Approve</button>
                                <button class="btn btn-danger" onclick="openReviewModal(${app.company_id || app.id}, 'reject')">Reject</button>
                            ` : `
                                <button class="btn btn-secondary" onclick="alert('${escapeHtml(app.notes || 'No notes')}')">View Notes</button>
                            `}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateStats(stats) {
            document.getElementById('stat-pending').textContent = stats.pending || 0;
            document.getElementById('stat-approved').textContent = stats.approved || 0;
            document.getElementById('stat-rejected').textContent = stats.rejected || 0;
            document.getElementById('stat-total').textContent = stats.total_companies || 0;
        }

        function filterApplications(status) {
            currentFilter = status;
            document.querySelectorAll('.filters .filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.toLowerCase() === status || (status === 'all' && btn.textContent === 'All')) {
                    btn.classList.add('active');
                }
            });
            loadApplications();
        }

        function openReviewModal(companyId, action) {
            document.getElementById('review-company-id').value = companyId;
            document.getElementById('review-action').value = action;
            document.getElementById('review-notes').value = '';
            document.getElementById('review-modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('review-modal').classList.remove('active');
        }

        async function submitReview(action) {
            const companyId = document.getElementById('review-company-id').value;
            const notes = document.getElementById('review-notes').value;
            
            try {
                const response = await fetch(`${API_BASE}/company/admin/approve.php`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        company_id: companyId,
                        action: action,
                        notes: notes
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    closeModal();
                    loadApplications();
                    alert(data.message);
                } else {
                    alert('Error: ' + data.message);
                }
            } catch (error) {
                console.error('Review error:', error);
                alert('Failed to submit review');
            }
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>

